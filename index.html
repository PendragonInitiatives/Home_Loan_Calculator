<script>
// ------------------------------
// Loan Calculator with Frequency & Sliders
// ------------------------------

// Utility: convert % to decimal
function rateToDecimal(annualRate) {
  return (annualRate / 100) / 12; // monthly rate
}

// Calculate base monthly repayment
function calculateMonthlyRepayment(loanAmount, annualRate, years) {
  const n = years * 12; // total months
  const r = rateToDecimal(annualRate);

  if (r === 0) return loanAmount / n; // no interest edge case

  return loanAmount * r / (1 - Math.pow(1 + r, -n));
}

function updateResults() {
  const loanAmount = parseFloat(document.getElementById('loanValue').value) || 0;
  const loanTerm   = parseFloat(document.getElementById('loanTerm').value) || 30;
  const interest   = parseFloat(document.getElementById('interestRate').value) || 6;

  // Slider values
  const extraRepay = parseFloat(document.getElementById('extraRepay').value) || 0;
  const offset     = parseFloat(document.getElementById('offset').value) || 0;
  const lumpSum    = parseFloat(document.getElementById('lumpSum').value) || 0;

  // Repayment frequency
  const frequency = document.getElementById('repaymentFrequency').value;

  // Adjust loan amount for lump sum + offset
  const adjustedLoan = Math.max(loanAmount - lumpSum - offset, 0);

  // Base monthly repayment
  let monthly = calculateMonthlyRepayment(adjustedLoan, interest, loanTerm);

  // Add extra repayment (per chosen frequency)
  let repayment = monthly;
  let periodLabel = "month";

  if (frequency === "fortnightly") {
    repayment = (monthly * 12 / 26);
    periodLabel = "fortnight";
    repayment += extraRepay;
  } else if (frequency === "weekly") {
    repayment = (monthly * 12 / 52);
    periodLabel = "week";
    repayment += extraRepay;
  } else {
    repayment = monthly + extraRepay;
  }

  // Total interest estimate (simplified)
  const periods = frequency === "monthly" ? 12 : (frequency === "fortnightly" ? 26 : 52);
  const total = repayment * loanTerm * periods;
  const totalInterest = total - adjustedLoan;

  // Compare against base loan
  const baseTotal = monthly * loanTerm * 12;
  const baseInterest = baseTotal - loanAmount;
  const interestSaved = baseInterest - totalInterest;

  // Update results section
  document.getElementById('regularRepayment').textContent = repayment.toFixed(2);
  document.getElementById('repaymentPeriod').textContent = periodLabel;
  document.getElementById('totalInterest').textContent = totalInterest.toFixed(2);
  document.getElementById('timeSaved').textContent = (interestSaved > 0 ? (interestSaved / baseInterest * loanTerm).toFixed(1) : 0);
  document.getElementById('interestSaved').textContent = interestSaved.toFixed(2);

  // Update slider display spans
  document.getElementById('extraRepayDisplay').textContent = extraRepay.toLocaleString();
  document.getElementById('offsetDisplay').textContent = offset.toLocaleString();
  document.getElementById('lumpSumDisplay').textContent = lumpSum.toLocaleString();
}

// Auto-update when page loads
document.addEventListener('DOMContentLoaded', () => {
  // Hook up inputs + sliders + dropdowns
  ['extraRepay','offset','lumpSum','loanValue','loanTerm','interestRate','repaymentFrequency']
    .forEach(id => {
      document.getElementById(id).addEventListener('input', updateResults);
      document.getElementById(id).addEventListener('change', updateResults);
    });

  updateResults();
});
</script>
