<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM Project Change - Home Loan Calculator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #181c40 0%, #2a2f5a 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .glass-section {
            background: rgba(216, 189, 125, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(216, 189, 125, 0.2);
        }
        
        .result-card {
            background: rgba(216, 189, 125, 0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            margin: 10px;
        }
        
        .money-saved-card {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
        }
        
        .grid-6 {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; }
        
        @media (max-width: 1400px) { .grid-6 { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 1024px) { .grid-3 { grid-template-columns: repeat(2, 1fr); } .grid-6 { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .grid-2, .grid-3, .grid-6 { grid-template-columns: 1fr; } body { padding: 12px; } }
        
        .input-field {
            width: 100%;
            background: rgba(24, 28, 64, 0.5);
            border: 1px solid rgba(216, 189, 125, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            outline: none;
            transition: border-color 0.3s;
            box-sizing: border-box;
            font-size: 1.1rem;
        }
        .input-field:focus { border-color: #d8bd7d; }
        
        .slider {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 5px;
            background: rgba(216, 189, 125, 0.3);
            outline: none;
            width: 100%;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #d8bd7d;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #d8bd7d;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        
        h1 { text-align: center; font-size: 3rem; margin-bottom: 10px; }
        h2 { font-size: 2rem; margin-bottom: 20px; }
        h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 15px; }
        
        .savings-message { color: #d8bd7d; font-size: 0.9rem; margin-top: 8px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: right; }
        th:first-child, td:first-child { text-align: left; }
        th { color: #b9c7d9; border-bottom: 2px solid rgba(216, 189, 125, 0.3); }
        tr:not(:last-child) { border-bottom: 1px solid rgba(216, 189, 125, 0.2); }
        .optimized-row { color: #d8bd7d; font-weight: 600; }
        .highlight-savings { color: #d8bd7d; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† PM Project Change</h1>
        <p style="text-align: center; font-size: 1.2rem; margin-bottom: 40px;">Home Loan Repayments Calculator</p>
        
        <!-- Basic Loan Details -->
        <div class="glass-section">
            <h2>Basic Loan Details</h2>
            <script src="index.js"></script>
            
        
        <!-- Money Saving Levers -->
        <div class="glass-section">
            <h2>Money Saving Levers</h2>
            <div class="grid-2">
                <div>
                    <h3>üí∞ Extra Repayments</h3>
                    <label style="display: block; margin-bottom: 8px;">Extra Amount: $<span id="extraDisplay">100</span></label>
                    <input type="range" id="extraSlider" min="0" max="2000" step="10" value="100" class="slider" oninput="updateExtra()" style="margin-bottom: 10px;">
                    <select id="extraFreq" class="input-field" onchange="calculate()">
                        <option value="weekly">Weekly</option>
                        <option value="fortnightly">Fortnightly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                    <div id="extraSavings" class="savings-message"></div>
                </div>
                
                <div>
                    <h3>üè¶ Offset Account</h3>
                    <label style="display: block; margin-bottom: 8px;">Offset Amount: $<span id="offsetDisplay">0</span></label>
                    <input type="range" id="offsetSlider" min="0" max="500000" step="10000" value="0" class="slider" oninput="updateOffset()">
                    <div id="offsetSavings" class="savings-message"></div>
                </div>
            </div>
        </div>
        
        <!-- Results -->
        <div class="glass-section">
            <h2>Your Results</h2>
            
            <div class="grid-6">
                <div class="result-card">
                    <h3>Regular Repayment</h3>
                    <p style="font-size: 1.5rem; font-weight: bold;">$<span id="regularRepayment">0</span></p>
                    <p>per month</p>
                </div>
                <div class="result-card">
                    <h3>Principal</h3>
                    <p style="font-size: 1.5rem; font-weight: bold;">$<span id="principal">0</span></p>
                    <p>loan amount</p>
                </div>
                <div class="result-card">
                    <h3>Interest Amount</h3>
                    <p style="font-size: 1.5rem; font-weight: bold;">$<span id="totalInterest">0</span></p>
                    <p>over loan term</p>
                </div>
                <div class="result-card">
                    <h3>Time Saved</h3>
                    <p style="font-size: 1.5rem; font-weight: bold;"><span id="timeSaved">0.0</span> years</p>
                    <p>with optimisations</p>
                </div>
                <div class="result-card money-saved-card">
                    <h3 style="color: #2ecc71;">Money Saved</h3>
                    <p style="font-size: 1.5rem; font-weight: bold; color: #2ecc71;">$<span id="moneySaved">0</span></p>
                    <p>with optimisations</p>
                </div>
                <div class="result-card">
                    <h3>Total Owing</h3>
                    <p style="font-size: 1.5rem; font-weight: bold;">$<span id="totalOwing">0</span></p>
                    <p>principal + interest</p>
                </div>
            </div>
            
            <!-- Comparison Table -->
            <h3>üìä Comparison Summary</h3>
            <table>
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Repayment</th>
                        <th>Interest</th>
                        <th>Total Owing</th>
                        <th>Loan Term</th>
                        <th>Interest Saved</th>
                    </tr>
                </thead>
                <tbody id="comparisonTable">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Utility functions
        function formatCurrency(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value) {
                input.value = parseInt(value).toLocaleString();
            }
        }

        function parseCurrency(value) {
            return parseInt(value.replace(/[^\d]/g, '')) || 0;
        }
        
        function updateExtra() {
            const value = document.getElementById('extraSlider').value;
            document.getElementById('extraDisplay').textContent = value;
            calculate();
        }
        
        function updateOffset() {
            const value = document.getElementById('offsetSlider').value;
            document.getElementById('offsetDisplay').textContent = parseInt(value).toLocaleString();
            calculate();
        }

        // Loan calculation function
        function calculateMonthlyPayment(principal, rate, term) {
            const monthlyRate = rate / 100 / 12;
            const numPayments = term * 12;
            
            if (rate === 0) return principal / numPayments;
            
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                   (Math.pow(1 + monthlyRate, numPayments) - 1);
        }

        // Main calculation function
        function calculate() {
            console.log('üßÆ Starting fresh calculation...');
            
            // Get inputs
            const loanAmount = parseCurrency(document.getElementById('loanAmount').value);
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const loanTerm = parseInt(document.getElementById('loanTerm').value) || 30;
            const extraAmount = parseInt(document.getElementById('extraDisplay').textContent) || 0;
            const offsetAmount = parseCurrency(document.getElementById('offsetDisplay').textContent);
            const extraFreq = document.getElementById('extraFreq').value;
            
            console.log('üìù Inputs:', { loanAmount, interestRate, loanTerm, extraAmount, offsetAmount, extraFreq });
            
            // Calculate base monthly payment
            const baseMonthlyPayment = calculateMonthlyPayment(loanAmount, interestRate, loanTerm);
            const baseInterest = (baseMonthlyPayment * loanTerm * 12) - loanAmount;
            
            // Apply optimisations
            const effectiveLoan = Math.max(0, loanAmount - offsetAmount);
            
            // Convert extra payments to monthly
            let extraPerMonth = 0;
            if (extraAmount > 0) {
                switch (extraFreq) {
                    case 'weekly': extraPerMonth = extraAmount * 52 / 12; break;
                    case 'fortnightly': extraPerMonth = extraAmount * 26 / 12; break;
                    case 'monthly': extraPerMonth = extraAmount; break;
                }
            }
            
            const optimizedPayment = baseMonthlyPayment + extraPerMonth;
            
            // Calculate optimized loan
            let totalInterest = 0;
            let payments = 0;
            let remainingBalance = effectiveLoan;
            const monthlyRate = interestRate / 100 / 12;
            
            if (effectiveLoan > 0) {
                while (remainingBalance > 0.01 && payments < loanTerm * 12) {
                    const interestPayment = remainingBalance * monthlyRate;
                    const principalPayment = Math.min(optimizedPayment - interestPayment, remainingBalance);
                    
                    if (principalPayment <= 0) break;
                    
                    totalInterest += interestPayment;
                    remainingBalance -= principalPayment;
                    payments++;
                }
            }
            
            const actualTerm = payments / 12;
            const timeSaved = Math.max(0, loanTerm - actualTerm);
            const interestSaved = Math.max(0, baseInterest - totalInterest);
            const totalOwing = loanAmount + totalInterest;
            
            console.log('üìä Results:', { 
                baseMonthlyPayment, 
                baseInterest, 
                totalInterest, 
                interestSaved, 
                timeSaved, 
                totalOwing 
            });
            
            // Update display
            document.getElementById('regularRepayment').textContent = Math.round(baseMonthlyPayment).toLocaleString();
            document.getElementById('principal').textContent = Math.round(loanAmount).toLocaleString();
            document.getElementById('totalInterest').textContent = Math.round(totalInterest).toLocaleString();
            document.getElementById('timeSaved').textContent = timeSaved.toFixed(1);
            document.getElementById('moneySaved').textContent = Math.round(interestSaved).toLocaleString();
            document.getElementById('totalOwing').textContent = Math.round(totalOwing).toLocaleString();
            
            // Update savings messages
            if (extraAmount > 0) {
                document.getElementById('extraSavings').textContent = `üí° Save $${Math.round(interestSaved).toLocaleString()} and ${timeSaved.toFixed(1)} years`;
            } else {
                document.getElementById('extraSavings').textContent = '';
            }
            
            if (offsetAmount > 0) {
                document.getElementById('offsetSavings').textContent = `üí° Save $${Math.round(interestSaved).toLocaleString()} and ${timeSaved.toFixed(1)} years`;
            } else {
                document.getElementById('offsetSavings').textContent = '';
            }
            
            // Update comparison table
            updateTable(baseMonthlyPayment, baseInterest, loanAmount, loanTerm, optimizedPayment, totalInterest, actualTerm, interestSaved, totalOwing);
            
            console.log('‚úÖ Calculation complete!');
        }
        
        function updateTable(basePayment, baseInterest, loanAmount, baseTerm, optimizedPayment, totalInterest, actualTerm, interestSaved, totalOwing) {
            const table = document.getElementById('comparisonTable');
            table.innerHTML = `
                <tr>
                    <td>Standard Loan</td>
                    <td>$${Math.round(basePayment).toLocaleString()}</td>
                    <td>$${Math.round(baseInterest).toLocaleString()}</td>
                    <td>$${Math.round(loanAmount + baseInterest).toLocaleString()}</td>
                    <td>${baseTerm} years</td>
                    <td>-</td>
                </tr>
                <tr class="optimized-row">
                    <td>With Optimisations</td>
                    <td>$${Math.round(optimizedPayment).toLocaleString()}</td>
                    <td>$${Math.round(totalInterest).toLocaleString()}</td>
                    <td>$${Math.round(totalOwing).toLocaleString()}</td>
                    <td>${actualTerm.toFixed(1)} years</td>
                    <td class="highlight-savings">$${Math.round(interestSaved).toLocaleString()}</td>
                </tr>
            `;
        }

        // Initialize calculator
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Fresh calculator loaded!');
            calculate();
        });
    </script>
</body>
</html>
